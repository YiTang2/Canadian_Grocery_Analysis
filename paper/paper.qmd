---
title: "My title"
subtitle: "My subtitle if needed"
author: 
  - Yi Tang
thanks: "Code and data are available at: https://github.com/YiTang2/Canadian_Grocery_Analysis.git "
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(palmerpenguins)
```


# Introduction

Overview paragraph

Estimand paragraph

Results paragraph

Why it matters paragraph

Telegraphing paragraph: The remainder of this paper is structured as follows. @sec-data....






# Data {#sec-data}

## Overview

Price of each month's coffee of different vendors data is provided by[@citedata]. This dataset records detailed sales about fast-moving consumer goods (FMCG) sold by various vendors, including volia, T&T, Loblaws, SaveOnFoods, Galleria, Metro, NoFrills and Walmart. It is also includes product-level details, such as the product name, current price, historical price (`old_price`), and the corresponding units and price per unit. The data also captures time-specific observations(2024-2-28 to 2024-6-22), with timestamps (nowtime) that can be used to analyze trends over days or months.

In order to simulate data, test simulated data, clean data, test cleaned data, exploratory data analysis and model data, we used R programming language [@citeR] to analyze the data and plot the graphs. Specific libraries that assisted the analysis include `tidyverse` [@citetidyverse], `palmerpenguins` [@palmerpenguins], `knitr` [@citeknitr], `arrow` [@citearrow], `ggplot2` [@citeggplot2],  `dplyr` [@citedplyr],  `here` [@citehere], `kableExtra` [@citekableExtra], `gridExtra`[@citegridExtra], `modelsummary`[@citemodelsummary], `rstanarm`[@citerstanarm].

The inspiration for my data processing came from my desire to study what factors would affect the current price of coffee products from two vendors in different regions of Canada, such as the current price of coffee products from two vendors, Metro and SaveOnFoods. The following variables are the data I selected after cleaning the data:

- `vendor`: The retailer selling the product in Canada.
- `old_price`: The historical price of the product, showing previous pricing or discounts.
- `product_name`: The specific product being sold, providing product-level insights.
- `current_price`: The price of the product at the time of observation.

New variable extracted and transformed from raw data:

- `month`: The month of data collection, extracted from `nowtime`.

Since the variable nowtime only records 4 months, it is considered a lack of Long-Term Trends, which means it's difficult to identify long-term pricing or demand patterns by using short data periods. So I only extracted a new variable—month from date of nowtime, which can simplify temporal analysis and identify trends, such as seasonal monthly pattern with price changes or demand patterns. It allows grouping data for monthly aggregation and supporting seasonality-focused insights or forecasting models.

To provide an preview of the coffee pricing with all potential factors that might affect it. Here, @tbl-sample-analysis-data simply reveals the variation between current price and old price in June for Metro's coffee products.

```{r}
#| label: tbl-sample-analysis-data
#| tbl-cap: "Sample of Analysis Data Showing Products Sold by Both Vendors"
#| echo: false
#| warning: false
#| message: false

# Load the analysis data
analysis_data <- read_parquet(here("data", "02-analysis_data", "analysis_data.parquet"))

# Select the first 10 rows
preview_table <- head(analysis_data, 10)

# Display the table
preview_table |>
  kable(
    col.names = colnames(preview_table),  # Use original column names
    digits = 2,  # Format numeric columns with 2 decimal places
    booktabs = TRUE,  # LaTeX-style formatting
    align = c("l", "l", "r", "r", "c"),  # Align columns (left, right, center)
    format.args = list(big.mark = ",")  # Add thousand separators to numbers
  ) |>
  kable_styling(full_width = FALSE, bootstrap_options = c("striped", "hover"))
```

## Measurement

The dataset from Hammer represents real-world retail activities, capturing product details, vendor listings, and price updates. When vendors update product information, such as pricing or availability, Hammer collects and structures this information into the dataset.

Key fields include vendor, product name, current price, old price, and nowtime. The data is collected through scraping and structured to enable analysis of retail trends, pricing strategies, and market dynamics over time. Each entry serves as a snapshot of a product's presence in the market at a specific time, allowing for focused analyses, like tracking price trends for specific products (e.g., coffee).

## Data Visualization

```{r}
#| label: fig-Hist-of-current-price
#| fig-cap: "Histogram of Current Price"
#| message: false
#| echo: false

# First Graph
ggplot(analysis_data, aes(x = current_price)) +
  geom_histogram(bins = 30, fill = "skyblue", color = "black") +
  labs(x = "Current Price", y = "Frequency") +
  theme_minimal()
```

@fig-Hist-of-current-price shows a notable distribution with significant concentrations around 10 and 20 units. This suggests a pricing tier system where certain types of coffee products might be grouped by price points due to quality, brand, or other market factors. The dual peaks could indicate two main categories of coffee products, possibly differentiated by premium versus regular products.

```{r}
#| label: fig-Hist-of-old-price
#| fig-cap: "Histogram of Old Price"
#| message: false
#| echo: false

# Second Graph

ggplot(analysis_data, aes(x = old_price)) +
  geom_histogram(bins = 30, fill = "salmon", color = "black") +
  labs(x = "Old Price", y = "Frequency") +
  theme_minimal()

```

According to @fig-Hist-of-old-price, the distribution is mainly focused between 5 and 20 units, pointing to a past market strategy where products were clustered around these prices. The consistency in this price range might reflect a stable market before any recent pricing adjustments influenced by external factors like supplier changes or inflation.

```{r}
#| label: fig-Bar-plot-of-old-price
#| fig-cap: "Bar Plot of Old Price"
#| message: false
#| echo: false

# Third Graph

ggplot(analysis_data, aes(x = vendor, fill = vendor)) +
  geom_bar() +
  scale_fill_brewer(palette = "Pastel1") +
  labs(x = "Vendor", y = "Frequency") +
  theme_minimal()
```

In @fig-Bar-plot-of-old-price, the frequency of products available from Metro significantly surpasses that from SaveOnFoods, suggesting that Metro has a larger share of the market or a wider variety of coffee products. This dominance in product offerings could provide Metro with a competitive edge in attracting a broader customer base.

```{r}
#| label: fig-scatter-plot-of-current-vs-old-price
#| fig-cap: "Scatterplot of Current Price vs Old Price"
#| message: false
#| echo: false

# Fourth Graph

ggplot(analysis_data, aes(x = old_price, y = current_price)) +
  geom_point(aes(color = vendor), alpha = 0.6) +
  scale_color_manual(values = c("Metro" = "blue", "SaveOnFoods" = "red")) +
  labs(x = "Old Price", y = "Current Price") +
  theme_minimal()

```

The positive relationship shown in @fig-scatter-plot-of-current-vs-old-price here indicates that current prices are influenced by their historical prices, maintaining a proportional increase or decrease. This trend suggests a pricing policy that adjusts prices based on previous benchmarks while taking into account factors like cost adjustments or market demand.

```{r}
#| label: fig-barplot-of-old-price
#| fig-cap: "Boxplot of Current Price by Vendor"
#| message: false
#| echo: false


# Fifth Graph
ggplot(analysis_data, aes(x = vendor, y = current_price)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.3, width = 0.15, height = 0) +
  labs(
    x = "Vendor",
    y = "Current Price"
  ) +
  theme_minimal()

```

@fig-Bar-plot-of-old-price highlights how each vendor prices their products within the market. It shows that both vendors offer a wide range of prices, yet the spread and density of the data points may indicate Metro’s pricing strategy targets both lower and upper market segments, whereas SaveOnFoods might be focusing on a specific niche.

# Model

The goal of our modelling strategy is twofold. Firstly,...

Here we briefly describe the Bayesian analysis model used to investigate... Background details and diagnostics are included in [Appendix -@sec-model-details].

## Model set-up

Define $y_i$ as the number of seconds that the plane remained aloft. Then $\beta_i$ is the wing width and $\gamma_i$ is the wing length, both measured in millimeters.  

\begin{align} 
y_i|\mu_i, \sigma &\sim \mbox{Normal}(\mu_i, \sigma) \\
\mu_i &= \alpha + \beta_i + \gamma_i\\
\alpha &\sim \mbox{Normal}(0, 2.5) \\
\beta &\sim \mbox{Normal}(0, 2.5) \\
\gamma &\sim \mbox{Normal}(0, 2.5) \\
\sigma &\sim \mbox{Exponential}(1)
\end{align}

We run the model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`.


### Model justification

We expect a positive relationship between the size of the wings and time spent aloft. In particular...

We can use maths by including latex between dollar signs, for instance $\theta$.


# Results

Our results are summarized in @tbl-modelresults.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false

library(rstanarm)

first_model <-
  readRDS(file = here::here("models/first_model.rds"))
```

```{r}
#| echo: false
#| eval: true
#| label: tbl-modelresults
#| tbl-cap: "Explanatory models of flight time based on wing width and wing length"
#| warning: false

modelsummary::modelsummary(
  list(
    "First model" = first_model
  ),
  statistic = "mad",
  fmt = 2
)
```




# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

Please don't use these as sub-heading labels - change them to be what your point actually is.

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows... 

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]

pp_check(first_model) +
  theme_classic() +
  theme(legend.position = "bottom")

posterior_vs_prior(first_model) +
  theme_minimal() +
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "bottom") +
  coord_flip()
```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2

plot(first_model, "trace")

plot(first_model, "rhat")
```



\newpage


# References


